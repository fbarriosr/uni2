
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Regla por defecto: denegar todo para mayor seguridad.
    match /{allPaths=**} {
      allow read, write: if false;
    }

    // Regla para imágenes de actividades:
    // Permite que cualquiera lea las imágenes (para que la app pueda mostrarlas).
    // Permite la escritura sin autenticación, ya que la Server Action no está autenticada.
    match /actividades/{activityId}/{allPaths=**} {
      allow read;
      allow write: if true;
    }

    // Regla para avatares de usuario:
    // Permite que cualquiera lea los avatares.
    // Permite la escritura solo si el usuario está autenticado y es el dueño de la ruta.
    match /users/{userId}/{allPaths=**} {
        allow read;
        allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regla para los recuerdos de las salidas:
    // Permite la lectura pública (si es necesario compartir).
    // Permite la escritura solo a usuarios autenticados.
    match /recuerdos/{salidaId}/{allPaths=**} {
        allow read;
        allow write: if request.auth != null;
    }

    // Regla para los expertos de la Academia del Vínculo
    match /vinculos/expertos/{expertId}/{allPaths=**} {
        allow read;
        allow write: if true;
    }
    
    // Regla para los expertos Legales
    match /legal/expertos/{expertId}/{allPaths=**} {
        allow read;
        allow write: if true;
    }
  }
}
